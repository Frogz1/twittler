<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <script src="jquery.js"></script>
  <script src="data_generator.js"></script>
  <script src="moment.js"></script>
  <link rel="stylesheet" type="text/css" href="stylesheet.css">
</head>

<body>
  <!-- <div>
      <button id="new-tweet">See Tweets</button>
    </div> -->
  <div class='nav'>
    <ul>
      <a id="home">Home</a>
      <a id="get-tweets">Refresh Tweets</a>
    </ul>
  </div>
  <div id='write-tweet'>
      <h1>What's happening?</h1>
      <input class='tweet-message' type="text" />
      <button id="send-message">Tweet</button>
    </div>
  <div class='new-tweets'>
    
  </div>
  <div class="tweet-stream"></div>
  <script>
    window.visitor = 'trevor';
    $(document).ready(function () {

        function getDate(date) {
        var d = new Date(date);var month = d.getMonth() + 1;
        var day = d.getDate();
        var time = d.getHours() + ':' + (d.getMinutes() < 10 ? '0' + d.getMinutes() : d.getMinutes()) + ':' + (d.getSeconds() < 10 ? '0' + d.getSeconds() : d.getSeconds());

        var output = ' ' + d.getFullYear() + '/' +
          (month < 10 ? '0' : '') + month + '/' +
          (day < 10 ? '0' : '') + day + ' ' + time;
        return output;
      }

      function updateHrTweets() {
        var $body = $('.tweet-stream');
        $body.html('');
        var index = streams.home.length - 1;
        
        while (index >= 0) {
          var tweet = streams.home[index];
          var $tweet = $("<div class='tweet'></div>");
          var utc = Date.parse(tweet.created_at);
          var date = getDate(new Date(tweet.created_at));          
          $tweet.attr('id', tweet.user);
          $tweet.html('@' + "<a  class='user'>" + tweet.user + '</a>' + ': ' + tweet.message + ' ' + moment(tweet.created_at).fromNow());
          //date);
          $tweet.appendTo($body);
          index -= 1;
        }
      };
      $(".nav").on('click', 'a', function(){
        
        updateHrTweets();
      }),
      $("#get-tweets")
      function sendTweetAsGuest(){
        var tweet = {};
        tweet.user = window.visitor;
        var message = 
        tweet.message = $('.tweet-message').val();
        tweet.created_at =getDate(new Date());
        streams.users[window.visitor] = [];
       
          addTweet(tweet);
      }
      $("#send-message").on('click', function(){
       
        sendTweetAsGuest();
        $('.tweet-message').val('');
        updateHrTweets();
       
      });

      $('.tweet-stream').on('click', 'a', function () {
        var $body = $('.tweet-stream');
        var user = $(this).closest('a').text();
        var index = streams.users[user].length -1;
        
        $body.html('');
        while (index >= 0){
          var tweet = streams.users[user][index];
          var $tweet = $("<div class='tweet'></div>");
          var utc = Date.parse(tweet.created_at);
          var date = getDate(new Date(tweet.created_at));          
          $tweet.attr('id', tweet.user);
          $tweet.html('@' + "<a  class='user'>" + tweet.user + '</a>' + ': ' + tweet.message + ' ' + moment(tweet.created_at).fromNow());
          $tweet.appendTo($body);
          index -= 1;
        }
      });
      
      $(function () {
        updateHrTweets();
        setInterval(updateHrTweets, 300000);        
      });      
    });
  </script>
</body>
</html>